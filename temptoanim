#!/bin/bash
# $1 is silentcast#
# $2 is fps
guake -t
cd
if [ $1 -eq 1 ]
then 
	cd ~/silentcast
	xdg-open ./
else
	cd ~/silentcast/silentcast
	xdg-open ./
fi
if [ -f anim.gif ]
then
	rm anim.gif
fi
if ls *png &> /dev/null
then
	rm *png
fi
ffmpeg -i temp.mkv -r $2 -an ew-%03d.png | zenity --progress --text="silentcast "$1": Creating images from temp.mkv" --pulsate --auto-close
while ! [ -f anim.gif ]
do
    cut=`zenity --entry \
        --title="SILENTCAST "$1": Prepare images before converting to Anim.gif" \
        --text="Manually delete or otherwise manipulate the images and click OK,\n   Or \nEnter any positive integer less than the total number of images. It works like this:\n0 would not delete anything, 1 would delete every other image,\n2 would delete 2 out of every 3 images, 3 would delete 3 out of every 4 images, ..." \
        --entry-text="0"`
    group=$((cut + 1))
    if [ $group -gt 1 ]
    then
    	count=0
    	for f in *png
    	do
    		    count=$((count + 1))
    		    if ! [ `expr $count % $group` = 1 ]
    		    then
    			    rm $f
    		    fi
    	done
    fi
    convert -adjoin -delay "$cut"x"$2" -layers optimize *png anim.gif | \
	    zenity --progress --text="silentcast "$1": Replacing images with anim.gif..." --pulsate --auto-close
    if ! [ -f anim.gif ]
    then 
    	  zenity --error --text="silentcast "$1": Too many images for the available memory - convert crashed. Try closing other applications, creating a swap file, or removing unecessary images."
    else
    	  rm *png
    fi
done

